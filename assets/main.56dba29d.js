var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(t,n,i)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i,s=(e,t)=>{for(var n in t||(t={}))a.call(t,n)&&r(e,n,t[n]);if(i)for(var n of i(t))o.call(t,n)&&r(e,n,t[n]);return e},l=(e,i)=>t(e,n(i)),u=(e,t,n)=>(r(e,"symbol"!=typeof t?t+"":t,n),n);import{n as d}from"./vendor.f688e3f2.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const c=e=>e>=0&&e<24&&e-Math.round(e)==0,m=(e,t=1)=>(e+24+t)%24;function h(){const e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div");return e.classList.add("background"),t.classList.add("background-tile-mask"),n.classList.add("background-tile"),e.appendChild(t),t.appendChild(n),{styleAndContainerElement:e,tileMaskElement:t,tileElement:n}}function b(e){var t;let n={};for(let[i,a]of e.entries())n[i]={pan:a.panner.pan.value,gain:a.audioSources[0].volumeGain.gain.value/(null!=(t=a.entity.gainCap)?t:p),entityId:a.entity.id};localStorage.setItem("ac.ambience_config",JSON.stringify(n))}function g(e,t){try{const n=localStorage.getItem("ac.ambience_config");if(!n)return void console.warn("null at ","ac.ambience_config");const i=JSON.parse(n);if(!function(e,t){if(null===t||"object"!=typeof t)return!1;for(let[n,i]of Object.entries(t)){if("string"!=typeof n)return!1;if("object"!=typeof i)return!1;if(null===i)return!1;if(!i.hasOwnProperty("entityId")||!i.hasOwnProperty("pan")||!i.hasOwnProperty("gain"))return!1;const t=i;if("string"!=typeof t.entityId||"number"!=typeof t.pan||"number"!=typeof t.gain)return!1;if(!e.has(t.entityId))return!1}return!0}(new Set(Object.keys(e)),i))return void console.warn("not a legal config",i);for(let e of Object.keys(i))t.addAmbienceNode(i[e].entityId,i[e].gain,i[e].pan)}catch(n){return void console.warn("Error loading config:",n)}}function _(e){return new Promise((t=>{setTimeout((()=>t()),e)}))}const p=2;function f(e,t){let n=!0,i=function*(e,t){for(let n=0;;n++)switch(t.type){case"random":yield e[Math.floor(Math.random()*e.length)];break;case"sequential":yield e[n%e.length]}}(t,e.sequenceMode);return(async()=>{var t;let a=!0;for(let o=i.next(),r=i.next();n;o=r,r=i.next()){if(o.done||r.done)throw new Error("Infinite ambience playback sequence was terminated.");const n=o.value,i=n.crossFadeGain.context.currentTime,s=Math.random()*(null!=(t=e.maxStartTimeOffset)?t:2);a?n.crossFadeGain.gain.value=1:(n.crossFadeGain.gain.value=0,n.crossFadeGain.gain.setTargetAtTime(1,i+n.fadeInDuration,.3*n.fadeInDuration));let l=n.element.duration;!Number.isNaN(l)&&Number.isFinite(l)?(void 0!==n.backupPlayDuration&&Math.abs(l-n.backupPlayDuration)>.01&&console.warn(`Mismatched backup play duration: ${n.element.src} had backup duration ${n.backupPlayDuration} but actual was ${l}`),n.crossFadeGain.gain.setTargetAtTime(0,i+l-s,.3*n.fadeOutDuration)):n.backupPlayDuration?(console.warn(`Duration was NaN or not finite (${l}), using backup duration of ${n.backupPlayDuration}`),l=n.backupPlayDuration):console.warn(`Duration was NaN or not finite (${l}), cannot calculate duration`),n.element.currentTime=s,n.element.play();const u=l-n.fadeOutDuration-r.value.fadeInDuration-s;await _(1e3*u),"random-wait"===e.cycleMode.type&&await _(Math.random()*(e.cycleMode.maxWaitSeconds-e.cycleMode.minWaitSeconds)+e.cycleMode.minWaitSeconds),a=!1}})(),()=>{t.forEach((e=>e.element.pause())),n=!1}}class k{constructor(e,t){u(this,"_parentElement"),u(this,"_elementContainer"),this._ambienceManager=e,this._ambienceNode=t}register(e){var t;this._parentElement=e;const n=this._parentElement.ownerDocument;this._elementContainer=n.createElement("div"),this._elementContainer.classList.add("ambience-node");const i=n.createElement("img");i.classList.add("ambience-icon"),i.src=this._ambienceNode.entity.iconUrl,i.alt=`${this._ambienceNode.entity.name}`;const a=n.createElement("div");a.classList.add("ambience-sliders-container");const o=n.createElement("input");o.classList.add("ambience-slider","volume"),o.type="range",o.step=.01.toString(),o.min=(0).toString(),o.max=(null!=(t=this._ambienceNode.entity.gainCap)?t:p).toString(),o.value=this._ambienceManager.getAmbienceNodeVolume(this._ambienceNode.id).toString(),o.title=`${this._ambienceNode.entity.name} Volume`,o.addEventListener("input",(()=>{this._ambienceManager.updateAmbienceNodeVolume(this._ambienceNode.id,o.valueAsNumber)}));const r=n.createElement("input");r.classList.add("ambience-slider","panning"),r.type="range",r.min=(-1).toString(),r.max=1..toString(),r.step=.01.toString(),r.value=this._ambienceManager.getAmbienceNodePan(this._ambienceNode.id).toString(),r.title=`${this._ambienceNode.entity.name} Left/Right Pan`,r.addEventListener("input",(()=>{this._ambienceManager.updateAmbienceNodePanning(this._ambienceNode.id,r.valueAsNumber)}));const s=n.createElement("button");s.classList.add("close-button"),s.addEventListener("click",(()=>{this._ambienceManager.removeAmbienceNode(this._ambienceNode.id)})),s.title=`Remove ${this._ambienceNode.entity.name}`,this._elementContainer.appendChild(i),this._elementContainer.appendChild(s);const l=n.createElement("div");l.classList.add("input-container","volume"),l.appendChild(o),a.appendChild(l);const u=n.createElement("div");u.classList.add("input-container","panner"),u.appendChild(r),a.appendChild(u),this._elementContainer.appendChild(a),e.appendChild(this._elementContainer)}unMountAndCleanup(){var e;this._elementContainer&&(null==(e=this._parentElement)||e.removeChild(this._elementContainer))}}const y=new class{constructor(e){u(this,"_callbacks",[]),u(this,"_cancelTimer"),u(this,"_hourOffset",0),u(this,"_minutesPeriod",60),u(this,"_hourlyTimeline"),this._hourlyTimeline=(e=>{const t=s({},e),n=new URL(window.location.toString());for(let i of Object.keys(t).map((e=>Number(e))).filter(c)){const a=e[i];t[i]=l(s({},a),{audioUrl:new URL(a.audioUrl,n).toString()})}return t})(e)}get hourOffset(){return this._hourOffset}setMinutePeriod(e){const t=new Date,n=this._getTimelinePositionForDate(t);this._minutesPeriod=Math.max(1,Math.min(60,e));const i=this._getTimelinePositionForDate(t);this._hourOffset+=n-i,this._updateTrackForTime(t)}setHourOffset(e){this._hourOffset=e,this._updateTrackForTime(new Date)}_getTimelinePositionForDate(e){const t=Math.floor((60*e.getHours()+e.getMinutes())/this._minutesPeriod)%24;if(!c(t))throw new Error("got illegal hour from date!");return m(t,this._hourOffset)}getTrackForTime(e){const t=this._getTimelinePositionForDate(e);return{previousTrack:this._getFromHourlyTimeline(t,-1),currentTrack:this._getFromHourlyTimeline(t,0),nextTrack:this._getFromHourlyTimeline(t,1)}}_getFromHourlyTimeline(e,t){const n=m(e,t);return l(s({},this._hourlyTimeline[n]),{timelinePosition:n})}start(){const e=new Date;this._updateTrackForTime(e)}_updateTrackForTime(e){const t=this.getTrackForTime(e);for(let a of this._callbacks)try{a(t)}catch(i){setTimeout((()=>{throw i}),0)}const n=function(e,t){const n=Math.floor(e.getMinutes()/t+1)*t;return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),n)}(e,this._minutesPeriod);this._cancelAndClearPendingTimeout(),this._cancelTimer=function(e,t){let n=null;function i(){var a=new Date;const o=e.getTime()-a.getTime();o<=0?t():n=setTimeout(i,Math.min(o,6e4))}return i(),()=>{n&&clearTimeout(n)}}(n,this._updateTrackForTime.bind(this,n))}stop(){this._cancelAndClearPendingTimeout()}_cancelAndClearPendingTimeout(){this._cancelTimer&&(this._cancelTimer(),this._cancelTimer=void 0)}registerTimelineCallback(e){this._callbacks.push(e)}}({0:{audioUrl:"./taking-root/music/0am-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"12AM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #040825,#0a0a1e)",backgroundTileImgUrl:"./taking-root/img/tile-midnight.png",blendMode:"default",darkLight:"dark"}},1:{audioUrl:"./taking-root/music/1am-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"1AM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #06000b, #0b050d)",backgroundTileImgUrl:"./taking-root/img/tile-1am.png",blendMode:"dodgerot",darkLight:"dark"}},2:{audioUrl:"./taking-root/music/2am-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"2 AM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #120733, #080818)",backgroundTileImgUrl:"./taking-root/img/tile-3am.png",blendMode:"funky",darkLight:"dark"}},3:{audioUrl:"./taking-root/music/3am-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"3 AM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #5c044d, #11000d)",backgroundTileImgUrl:"./taking-root/img/tile-latenight.png",blendMode:"exclusion",darkLight:"dark"}},4:{audioUrl:"./taking-root/music/4am-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"},{name:"⚣ RUD ⚣",profileUrl:"https://twitter.com/driftrud"}],title:"4 AM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #35022c, #11000d)",backgroundTileImgUrl:"./taking-root/img/tile-4am.png",blendMode:"exclusion",darkLight:"dark"}},5:{audioUrl:"./taking-root/music/5am-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"5 AM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #540e1e, #29081d)",backgroundTileImgUrl:"./taking-root/img/tile-weeb.png",blendMode:"exclusion",darkLight:"dark"}},6:{audioUrl:"./taking-root/music/6am-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"6 AM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #d7561d, #faeec1)",backgroundTileImgUrl:"./taking-root/img/tile-shell.png"}},7:{audioUrl:"./taking-root/music/7am-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"7 AM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #7ace20, #3f5117)",backgroundTileImgUrl:"./taking-root/img/tile-warm-fruit.png"}},8:{audioUrl:"./taking-root/music/8am-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"8 AM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #67d0e7, #6fc4d5, #2b627f)",backgroundTileImgUrl:"./taking-root/img/tile-garden.png",blendMode:"default"}},9:{audioUrl:"./taking-root/music/9am-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"9 AM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #94c743, #80b03b, #61a152, #1b6231)",backgroundTileImgUrl:"./taking-root/img/tile-work.png",blendMode:"transparent-soft"}},10:{audioUrl:"./taking-root/music/10am-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"10 AM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #89d878, #42b760, #42b760)",backgroundTileImgUrl:"./taking-root/img/tile-butterflies-blue.png",blendMode:"half-visible"}},11:{audioUrl:"./taking-root/music/11am-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"11 AM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #7ac9f6, #b5d3a1, #9ec87b)",backgroundTileImgUrl:"./taking-root/img/tile-weeb.png",blendMode:"gray-soft"}},12:{audioUrl:"./taking-root/music/12pm-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"12 PM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #d9d7e5, #d5d4e4, #b97b75, #b94350)",backgroundTileImgUrl:"./taking-root/img/tile-cards.png",blendMode:"half-visible"}},13:{audioUrl:"./taking-root/music/1pm-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"1 PM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #caa685, #c9a786, #c2af8f, #bcb697, #9d9786, #837e78)",backgroundTileImgUrl:"./taking-root/img/tile-bones.png",blendMode:"half-visible"}},14:{audioUrl:"./taking-root/music/2pm-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"2 PM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #c9c0a9, #c39370, #b64a51)",backgroundTileImgUrl:"./taking-root/img/tile-cozy.png",blendMode:"gray-soft"}},15:{audioUrl:"./taking-root/music/3pm-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"3 PM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #8a92ff, #c3c5fb, #dad9f9)",backgroundTileImgUrl:"./taking-root/img/tile-ski.png",blendMode:"half-visible"}},16:{audioUrl:"./taking-root/music/4pm-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"4 PM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to top, #7a597e, #b3a5bd, #b3a5bd)",backgroundTileImgUrl:"./taking-root/img/tile-rich-purple.png",blendMode:"half-visible"}},17:{audioUrl:"./taking-root/music/5pm-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"},{name:"⚣ RUD ⚣",profileUrl:"https://twitter.com/driftrud"}],title:"5 PM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to top, #9384be, #a47fb5, #c490a6, #e8b8c7, #e8bac0)",backgroundTileImgUrl:"./taking-root/img/tile-shell.png",blendMode:"transparent-soft"}},18:{audioUrl:"./taking-root/music/6pm-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"6 PM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #c753bb, #c573a6, #d087aa)",backgroundTileImgUrl:"./taking-root/img/tile-red-fish.png",blendMode:"half-visible"}},19:{audioUrl:"./taking-root/music/7pm-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"7 PM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #885ab2, #855a88, #8a5f85, #a16f9c)",backgroundTileImgUrl:"./taking-root/img/tile-cards.png",blendMode:"gray-soft"}},20:{audioUrl:"./taking-root/music/8pm-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"8 PM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #5a449d, #5a3e7a, #6e4c95)",backgroundTileImgUrl:"./taking-root/img/tile-evening.png",blendMode:"transparent-soft",darkLight:"dark"}},21:{audioUrl:"./taking-root/music/9pm-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"9 PM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #353393, #241b4d)",backgroundTileImgUrl:"./taking-root/img/tile-latenight.png",blendMode:"transparent-soft",darkLight:"dark"}},22:{audioUrl:"./taking-root/music/10pm-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"10 PM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #1c2742, #171730)",backgroundTileImgUrl:"./taking-root/img/tile-10pm.png",blendMode:"transparent-soft",darkLight:"dark"}},23:{audioUrl:"./taking-root/music/11pm-loop.mp3",meta:{by:[{name:"Scruffy",profileUrl:"https://twitter.com/Scruffy_Tweets"}],title:"11 PM - Taking Root",bannerUrl:"./taking-root/img/default-banner-new.png",backgroundStyle:"linear-gradient(to bottom, #120733, #080818)",backgroundTileImgUrl:"./taking-root/img/tile-11pm.png",blendMode:"exclusion",darkLight:"dark"}}}),v=window.location.hash.length?parseInt(window.location.hash.substring(1)):null;v&&c(v)&&y.setHourOffset(v-(new Date).getHours());const E=new class{constructor(e){u(this,"_volumeListeners",[]),u(this,"_volumeRangeElement"),u(this,"_volumeContainerElement"),u(this,"_volumeClearTimeout"),this._volume=e}register(e,t){this._volumeRangeElement=e,this._volumeContainerElement=t,this._volumeRangeElement.valueAsNumber=this._volume,this._notifyVolumeChanged(),this._volumeRangeElement.addEventListener("input",(()=>{if(!this._volumeRangeElement)throw new Error("this._volumeRangeElement became unbound");this._volume=this._volumeRangeElement.valueAsNumber,this._notifyVolumeChanged()}))}_notifyVolumeChanged(){for(let t of this._volumeListeners)try{t(this._volume)}catch(e){setTimeout((()=>{throw e}),0)}}registerVolumeChangedCallback(e){this._volumeListeners.push(e)}addVolume(e){this._volume=Math.min(1,Math.max(0,this._volume+e)),this._updateUI(),this._notifyVolumeChanged()}_updateUI(){if(this._volumeRangeElement&&(this._volumeRangeElement.valueAsNumber=this._volume),this._volumeContainerElement){const e=this._volumeContainerElement;e.classList.add("auto-updated"),this._volumeClearTimeout&&clearTimeout(this._volumeClearTimeout),this._volumeClearTimeout=setTimeout((()=>{e.classList.remove("auto-updated")}),800)}}}(.8),w=new class{constructor(e,t,n){u(this,"_currentAudioElement"),u(this,"_preloadAudioElement"),u(this,"_bellChimeAudioElement"),u(this,"_isBellChimeEnabled",!1),u(this,"_isWaitingForBell",!1),u(this,"_isPlaying",!1),u(this,"_playPauseCallbacks",[]),u(this,"_onBellDone",(()=>{var e;this._playIfPlaying(),null==(e=this._bellChimeAudioElement)||e.removeEventListener("ended",this._onBellDone)})),this._bellChimeUrl=e,this._timelineManager=t,this._volumeSlider=n}get isPlaying(){return this._isPlaying}register(e){this._bellChimeAudioElement=document.createElement("audio"),this._currentAudioElement=document.createElement("audio"),this._preloadAudioElement=document.createElement("audio"),this._bellChimeAudioElement.src=this._bellChimeUrl,this._bellChimeAudioElement.loop=!1,this._currentAudioElement.loop=!0,this._preloadAudioElement.loop=!0,this._bellChimeAudioElement.preload="auto",this._currentAudioElement.preload="auto",this._preloadAudioElement.preload="auto",e.appendChild(this._currentAudioElement),e.appendChild(this._preloadAudioElement),this._currentAudioElement.addEventListener("canplay",this._startPlaybackIfCurrent.bind(this)),this._preloadAudioElement.addEventListener("canplay",this._startPlaybackIfCurrent.bind(this)),this._currentAudioElement.addEventListener("pause",this._pausePlaybackIfCurrent.bind(this)),this._preloadAudioElement.addEventListener("pause",this._pausePlaybackIfCurrent.bind(this)),this._timelineManager.registerTimelineCallback(this._onTrackUpdated.bind(this)),this._volumeSlider.registerVolumeChangedCallback(this._onVolumeUpdated.bind(this))}_startPlaybackIfCurrent(e){e.target===this._currentAudioElement&&this._isPlaying&&!this._isWaitingForBell&&this._currentAudioElement.play()}_pausePlaybackIfCurrent(e){e.target===this._currentAudioElement&&this._isPlaying&&(this._isPlaying=!1,this._onPlayPause())}play(){this._isPlaying=!0;const e=new Date;this._onTrackUpdated(this._timelineManager.getTrackForTime(e)),this._onPlayPause()}_onVolumeUpdated(e){if(!(this._currentAudioElement&&this._preloadAudioElement&&this._bellChimeAudioElement))throw new Error("AudioPlayer._onVolumeUpdated called before registration?");this._currentAudioElement.volume=e,this._preloadAudioElement.volume=e,this._bellChimeAudioElement.volume=e}_onTrackUpdated(e){if(!this._currentAudioElement||!this._preloadAudioElement)throw new Error("_onTrackUpdated() was called before audio elements were initialized");if(this._readyTracksForPlayback(e),this._preloadAudioElement.pause(),this._isPlaying&&this._isBellChimeEnabled&&this._bellChimeAudioElement){this._currentAudioElement.pause();const e=this._bellChimeAudioElement;e.currentTime=0,this._isWaitingForBell=!0,e.play(),this._bellChimeAudioElement.addEventListener("ended",this._onBellDone)}else this._playIfPlaying()}_playIfPlaying(){var e,t;this._isPlaying?null==(e=this._currentAudioElement)||e.play():null==(t=this._currentAudioElement)||t.pause()}_readyTracksForPlayback({currentTrack:e,nextTrack:t}){if(!this._currentAudioElement||!this._preloadAudioElement)throw new Error("_readyTracksForPlayback() was called before audio elements were initialized");if(e.audioUrl!==this._currentAudioElement.src||t.audioUrl!==this._preloadAudioElement.src){if(this._preloadAudioElement.src===e.audioUrl){const e=this._currentAudioElement;this._currentAudioElement=this._preloadAudioElement,this._preloadAudioElement=e}else this._currentAudioElement.src=e.audioUrl;this._preloadAudioElement.src=t.audioUrl}}pause(){var e,t;this._isPlaying=!1,null==(e=this._currentAudioElement)||e.pause(),null==(t=this._preloadAudioElement)||t.pause(),this._onPlayPause()}registerPlayPauseCallback(e){this._playPauseCallbacks.push(e)}_onPlayPause(){for(let t of this._playPauseCallbacks)try{t(this.isPlaying)}catch(e){setTimeout((()=>{throw e}),0)}}get isBellChimeEnabled(){return this._isBellChimeEnabled}setBellChimeEnabled(e){var t;!e&&this._isWaitingForBell&&(null==(t=this._bellChimeAudioElement)||t.pause(),this._onBellDone()),this._isBellChimeEnabled=e}}("./taking-root/music/taking-root-village-chime.mp3",y,E),C=new class{constructor(e){u(this,"_button"),this._audioPlayer=e}register(e){this._button=e,this._button.addEventListener("click",this._buttonClicked.bind(this)),this._updateButtonUI()}_buttonClicked(){this.toggleBell()}toggleBell(){this._audioPlayer.setBellChimeEnabled(!this._audioPlayer.isBellChimeEnabled),this._updateButtonUI()}_updateButtonUI(){this._button&&(this._button.classList.toggle("bell-enabled",this._audioPlayer.isBellChimeEnabled),this._button.innerText=(this._audioPlayer.isBellChimeEnabled?"Disable":"Enable")+" Hourly Bell")}}(w),T=new class{constructor(e){u(this,"_titleElement"),u(this,"_bannerImgElement"),u(this,"_artistContainer"),u(this,"_container"),this._timelineManager=e}register(e,t,n,i){this._timelineManager.registerTimelineCallback(this._onTrackUpdated.bind(this)),this._container=e,this._titleElement=t,this._bannerImgElement=n,this._artistContainer=i}_onTrackUpdated({currentTrack:{meta:e}}){var t;if(!this._container||!this._titleElement||!this._bannerImgElement)throw new Error("MetaDisplay._onTrackUpdated called before register()");if("dark"===(null==e?void 0:e.darkLight)?this._container.classList.add("darkmode"):this._container.classList.remove("darkmode"),(null==e?void 0:e.title)&&(this._titleElement.innerHTML=e.title),(null==e?void 0:e.bannerUrl)&&(this._bannerImgElement.src=e.bannerUrl),(null==e?void 0:e.by)&&this._artistContainer){for(;this._artistContainer.childNodes.length;)null==(t=this._artistContainer)||t.removeChild(this._artistContainer.childNodes[0]);const n=e.by.map((e=>{const t=document.createElement("a");return t.textContent=e.name,t.href=e.profileUrl,t}));let i;for(;i=n.shift();)this._artistContainer.appendChild(i),n.length&&e.by.length>2&&this._artistContainer.appendChild(document.createTextNode(", ")),1==n.length&&this._artistContainer.appendChild(document.createTextNode(" and "))}}}(y),A=new class{constructor(e){u(this,"_skipBackButton"),u(this,"_skipNextButton"),this._timelineManager=e}register(e,t){this._skipBackButton=e,this._skipNextButton=t,this._skipBackButton.addEventListener("click",this._skipBack.bind(this)),this._skipNextButton.addEventListener("click",this._skipNext.bind(this))}_skipBack(){this._timelineManager.setHourOffset(this._timelineManager.hourOffset-1)}_skipNext(){this._timelineManager.setHourOffset(this._timelineManager.hourOffset+1)}}(y),M=new class{constructor(e){u(this,"_containers",[]),u(this,"_commonBackground"),u(this,"_lastTrackPosition"),this._timelineManager=e}register(e){this._commonBackground=e;for(let t=0;t<4;t++){const t=h();this._containers.push({elements:t}),e.appendChild(t.styleAndContainerElement)}this._timelineManager.registerTimelineCallback(this._onTimelineUpdated.bind(this))}_onTimelineUpdated({currentTrack:e,nextTrack:t,previousTrack:n}){const i=[e.timelinePosition,t.timelinePosition,n.timelinePosition];this._lastTrackPosition&&(i.push(this._lastTrackPosition),i.push(m(this._lastTrackPosition,1)),i.push(m(this._lastTrackPosition,-1)));const a=this._containers.filter((e=>i.every((t=>e.assignedToTimelinePosition!==t))));this._findOrCreateBackground(n,this._containers,a);const o=this._findOrCreateBackground(e,this._containers,a);this._findOrCreateBackground(t,this._containers,a);for(let r of this._containers)r.elements.styleAndContainerElement.classList.remove("active");o.elements.styleAndContainerElement.classList.add("active"),this._commonBackground&&(this._commonBackground.style.background=e.meta.backgroundStyle),this._lastTrackPosition=e.timelinePosition}_findOrCreateBackground(e,t,n){for(let a of t)if(a.assignedToTimelinePosition===e.timelinePosition)return a;const i=n.pop();if(!i)throw new Error(`unable to free a container for track with timeline position ${e.timelinePosition}`);return function(e,t){if(null==t?void 0:t.backgroundTileImgUrl){const n=`url('${new URL(t.backgroundTileImgUrl,window.location.toString()).toString()}')`;e.tileElement.style.backgroundImage=n,e.tileElement.style.setProperty("--bg-tile",n)}(null==t?void 0:t.backgroundStyle)&&(e.styleAndContainerElement.style.background=t.backgroundStyle);for(let i of Array.from(e.tileMaskElement.classList))i.endsWith("-blend")&&e.tileMaskElement.classList.remove(i);e.tileMaskElement.classList.add((t.blendMode||"default")+"-blend");const n=e.tileElement.parentElement;n&&(n.removeChild(e.tileElement),n.appendChild(e.tileElement))}(i.elements,e.meta),i.assignedToTimelinePosition=e.timelinePosition,i}}(y),U=new class{constructor(e){u(this,"_ambienceNodes",new Map),u(this,"_audioContext"),u(this,"_audioHostElement"),u(this,"_onBeforeNodeAddedCb",[]),u(this,"_onNodeAddedCb",[]),u(this,"_onNodeRemovedCb",[]),u(this,"_analyserNode"),u(this,"_knownEntities",{});for(let[t,n]of Object.entries(e))this._knownEntities[t]=l(s({},n),{id:t});this._audioContext=new(window.AudioContext||window.webkitAudioContext)({latencyHint:"playback"})}register(e){this._audioHostElement=e}insertAnalyser(){if(!this._audioContext)throw new Error("No _audioContext, insertAnalyser called before register()?");if(this._ambienceNodes.size)throw new Error("Called insertAnalyser after adding ambience");return this._analyserNode=this._audioContext.createAnalyser(),this._analyserNode}registerAddedORemovedCallback(e,t){this._onNodeAddedCb.push(e),this._onNodeRemovedCb.push(t)}registerOnBeforeNodeAddedCallback(e){this._onBeforeNodeAddedCb.push(e)}isPlaying(){return 0!==this._ambienceNodes.size}getAvailableEntities(){return[...Object.entries(this._knownEntities)]}tryRestoreConfig(){g(this._knownEntities,this)}addAmbienceNode(e,t,n=0){"suspended"===this._audioContext.state&&this._audioContext.resume();const i=this._knownEntities[e];if(!i)throw new Error(`tried to add AmbienceNode with unknown entity id: ${e}`);if(!this._audioHostElement)throw new Error("audioHostElement was not defined. Was addEntity() called before register()?");for(let s of this._onBeforeNodeAddedCb)s(i);const a=this._audioContext.createStereoPanner();a.pan.value=n;const o=[...i.audioAssets,...i.audioAssets].map((e=>{var n;const o=document.createElement("audio");o.volume=1,o.src=e.url,this._audioHostElement.appendChild(o);const r=this._audioContext.createMediaElementSource(o),u=this._audioContext.createGain(),d=this._audioContext.createGain();return r.connect(d),d.connect(u),d.gain.value=t*(null!=(n=i.gainCap)?n:p),u.connect(a),u.gain.value=1,l(s({},e),{element:o,source:r,crossFadeGain:u,volumeGain:d})}));this._analyserNode&&a.connect(this._analyserNode),a.connect(this._audioContext.destination);const r=f(i,o),u={id:d(),entity:i,audioSources:o,cleanupAndStopPlayback:r,panner:a};return this._ambienceNodes.set(u.id,u),this._onNodeAddedCb.forEach((e=>{try{e(u)}catch(t){setTimeout((()=>{throw t}),0)}})),b(this._ambienceNodes),u.id}removeAmbienceNode(e){var t,n;const i=this._ambienceNodes.get(e);if(i){i.cleanupAndStopPlayback();for(let e of i.audioSources)e.volumeGain.disconnect(),e.crossFadeGain.disconnect(),e.source.disconnect();i.panner.disconnect();for(let e of i.audioSources)e.element.pause(),e.element.onended=null,null==(n=null==(t=this._audioHostElement)?void 0:t.removeChild)||n.call(t,e.element);this._ambienceNodes.delete(e),this._onNodeRemovedCb.forEach((e=>{try{e(i)}catch(t){setTimeout((()=>{throw t}),0)}})),0===this._ambienceNodes.size&&setTimeout((()=>{0===this._ambienceNodes.size&&this._audioContext.suspend()}),1e3),b(this._ambienceNodes)}}updateAmbienceNodeVolume(e,t){const n=this._ambienceNodes.get(e);if(!n)throw new Error(`Tried to update volume of missing audio node ${e}`);for(let i of n.audioSources)i.volumeGain.gain.value=t;b(this._ambienceNodes)}getAmbienceNodeVolume(e){const t=this._ambienceNodes.get(e);if(!t)throw new Error(`Could not get volume of unknown node ${e}`);return t.audioSources[0].volumeGain.gain.value}getAmbienceNodePan(e){const t=this._ambienceNodes.get(e);if(!t)throw new Error(`Could not get LR pan of unknown node ${e}`);return t.panner.pan.value}updateAmbienceNodePanning(e,t){const n=this._ambienceNodes.get(e);if(!n)throw new Error(`Tried to update volume of missing audio node ${e}`);n.panner.pan.value=t,b(this._ambienceNodes)}randomizeAmbienceNodes(e=5){for(let n of[...this._ambienceNodes.keys()])this.removeAmbienceNode(n);const t=this.getAvailableEntities().map((([e])=>e));for(let n=0;n<e;n++){const n=t[Math.floor(Math.random()*t.length)];this.addAmbienceNode(n,.1+.5*Math.random()*(1/e),Math.max(-1,Math.min(1,Math.random()-Math.random())))}}}({calmRain:{name:"Calm Rain",audioAssets:[{url:"./ambience/env/Env_BaseRainCalm.mp3",fadeInDuration:2,fadeOutDuration:7,backupPlayDuration:20.560062}],cycleMode:{type:"solid-loop"},sequenceMode:{type:"sequential"},iconUrl:"./ambience/icon/cloud-rain.svg",gainCap:3},indoorTentRain:{name:"Indoor Tent Rain",audioAssets:[{url:"./ambience/env/Env_IdrTent_BaseRainCalm00.mp3",fadeInDuration:2,fadeOutDuration:7,backupPlayDuration:20.631583}],cycleMode:{type:"solid-loop"},sequenceMode:{type:"sequential"},iconUrl:"./ambience/icon/campground.svg",gainCap:3},grassWindSummerWeak:{name:"Weak Summer Wind",audioAssets:[{url:"./ambience/env/Env_GrassWindSummerWeak.mp3",fadeInDuration:2,fadeOutDuration:7,backupPlayDuration:27.817666}],cycleMode:{type:"solid-loop"},sequenceMode:{type:"sequential"},iconUrl:"./ambience/icon/wind.svg"},campfire:{name:"Campfire",audioAssets:[{url:"./ambience/env/campfire-cagan-celik-freesound.mp3",fadeInDuration:2,fadeOutDuration:7,backupPlayDuration:53.986168}],cycleMode:{type:"solid-loop"},sequenceMode:{type:"sequential"},iconUrl:"./ambience/icon/campfire.svg"},seaRocks:{name:"Trickling Stream",audioAssets:[{url:"./ambience/env/Env_SeaWaterrock00.mp3",fadeInDuration:2,fadeOutDuration:12,backupPlayDuration:21},{url:"./ambience/env/Env_SeaWaterrock01.mp3",fadeInDuration:2,fadeOutDuration:12,backupPlayDuration:21},{url:"./ambience/env/Env_SeaWaterrock02.mp3",fadeInDuration:2,fadeOutDuration:12,backupPlayDuration:21},{url:"./ambience/env/Env_SeaWaterrock03.mp3",fadeInDuration:2,fadeOutDuration:12,backupPlayDuration:21}],cycleMode:{type:"solid-loop"},sequenceMode:{type:"random"},iconUrl:"./ambience/icon/water.svg"},seaWaves:{name:"Beach Waves",audioAssets:[{url:"./ambience/env/Env_SeaWaterWave00.mp3",fadeInDuration:2,fadeOutDuration:7,backupPlayDuration:12.336},{url:"./ambience/env/Env_SeaWaterWave01.mp3",fadeInDuration:2,fadeOutDuration:7,backupPlayDuration:12.757333},{url:"./ambience/env/Env_SeaWaterWave02.mp3",fadeInDuration:2,fadeOutDuration:7,backupPlayDuration:14.404437},{url:"./ambience/env/Env_SeaWaterWave03.mp3",fadeInDuration:2,fadeOutDuration:7,backupPlayDuration:12.08}],cycleMode:{type:"solid-loop"},sequenceMode:{type:"random"},iconUrl:"./ambience/icon/umbrella-beach.svg"},bugs:{name:"Bugs",gainCap:.5,audioAssets:[{url:"./ambience/bugs/Insect_Aburazemi_WaitA01.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Aburazemi_WaitA.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Kirigirisu_Wait00.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Kirigirisu_Wait01.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Kohrogi_Wait00.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Kohrogi_Wait01.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Kumazemi_WaitA00.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Kumazemi_WaitB00.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Minminzemi_Wait00.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Minminzemi_Wait01.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Okera_Wait00.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Suzumushi_Wait00.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Suzumushi_Wait01.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Tsukutsukuhoushi_WaitA00.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Tsukutsukuhoushi_WaitA01.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Tsukutsukuhoushi_WaitA02.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Tsukutsukuhoushi_WaitB00.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Tsukutsukuhoushi_WaitB01.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Tsukutsukuhoushi_WaitB02.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4},{url:"./ambience/bugs/Insect_Tsukutsukuhoushi_WaitC00.mp3",fadeInDuration:0,fadeOutDuration:0,backupPlayDuration:4}],cycleMode:{type:"random-wait",minWaitSeconds:.2,maxWaitSeconds:.7},sequenceMode:{type:"random"},iconUrl:"./ambience/icon/bug.svg",maxStartTimeOffset:0}}),P=new class{constructor(e){u(this,"_ambienceNodeUIElements",new Map),u(this,"_ambienceUIContainer"),u(this,"_ambienceNodesContainer"),this._ambienceManager=e}register(e){this._ambienceUIContainer=e,this._ambienceManager.registerAddedORemovedCallback(this._onAmbienceNodeAdded.bind(this),this._onAmbienceNodeRemoved.bind(this)),this._mountAddRemoveUI(),this._mountNodesContainer()}_mountNodesContainer(){if(!this._ambienceUIContainer)throw new Error("tried to mount nodes container before registering?");const e=this._ambienceUIContainer.ownerDocument;this._ambienceNodesContainer=e.createElement("div"),this._ambienceNodesContainer.classList.add("ambience-nodes-container"),this._ambienceUIContainer.appendChild(this._ambienceNodesContainer)}_mountAddRemoveUI(){if(!this._ambienceUIContainer)throw new Error("tried to mount add/remove UI before registering?");const e=this._ambienceUIContainer.ownerDocument,t=e.createElement("div");t.classList.add("ambience-add-remove-ui-wrapper");for(let[n,i]of this._ambienceManager.getAvailableEntities()){const a=e.createElement("button");a.classList.add("ambience-ui-add-button","media-button","smaller-media-button"),a.title=`${i.name}`;const o=e.createElement("img");o.classList.add("ambience-icon"),o.src=i.iconUrl,a.appendChild(o),a.addEventListener("click",(()=>{this._ambienceManager.addAmbienceNode(n,.4)})),t.appendChild(a)}if(this._ambienceManager.getAvailableEntities().length>1){const n=e.createElement("button");n.classList.add("ambience-ui-add-button","media-button","smaller-media-button","blue-button"),n.title="Randomize Ambience";const i=e.createElement("img");i.classList.add("ambience-icon"),i.src="./ambience/icon/shuffle.svg",n.appendChild(i),n.addEventListener("click",(()=>{this._ambienceManager.randomizeAmbienceNodes(Math.round(3*Math.random()+2))})),t.appendChild(n)}this._ambienceUIContainer.appendChild(t)}_onAmbienceNodeAdded(e){const t=new k(this._ambienceManager,e);if(!this._ambienceNodesContainer)throw new Error("no _ambienceNodesContainer. _onAmbienceNodeAdded called before register()?");t.register(this._ambienceNodesContainer),this._ambienceNodeUIElements.set(e.id,t)}_onAmbienceNodeRemoved(e){const t=this._ambienceNodeUIElements.get(e.id);if(!t)throw new Error("tried to delete AmbienceNodeUI for which there was no existing ui");this._ambienceNodeUIElements.delete(e.id),t.unMountAndCleanup()}}(U);function S(e,t){const n=document.querySelector(t);if(n instanceof e)return n;throw new Error(`Selector ${t} was not a ${e.name}`)}const D=new class{constructor(e,t,n,i,a){u(this,"_audioSource"),u(this,"_analyser"),u(this,"_out_arr"),u(this,"_targetCanvas"),u(this,"_canvasCtx2D"),u(this,"_binSums"),u(this,"_binCounts"),u(this,"_binWidth"),u(this,"_binGap"),u(this,"running",!1),u(this,"initialized",!1),u(this,"_overrunFrameCount",0),this._ambienceManager=e,this._binCount=t,this._fillStyle=n,this._fftScaleRatio=i,this._binPaddingPercent=a,this._binSums=Array(this._binCount).fill(0),this._binCounts=Array(this._binCount).fill(0)}register(e){this._targetCanvas=e,this._binGap=this._targetCanvas.width*this._binPaddingPercent,this._ambienceManager.registerOnBeforeNodeAddedCallback(this._onAmbienceNodeAdded.bind(this))}_onAmbienceNodeAdded(){this.running||(this.running=!0,this._start())}_initialize(){if(!this._targetCanvas||!this._binGap)throw new Error("delayedRegister called before canvas was registere");this._audioSource=this._ambienceManager.insertAnalyser();const e=this._targetCanvas.getContext("2d");if(!e)throw new Error("failed to get canvas 2d context: cannot render ambience FFT");this._canvasCtx2D=e,this._analyser=this._audioSource.context.createAnalyser(),this._analyser.fftSize=64,this._audioSource.connect(this._analyser),this._binWidth=(this._targetCanvas.width-this._binGap*(this._binCount-1))/this._binCount,this._out_arr=new Uint8Array(this._analyser.frequencyBinCount),this._analyser.frequencyBinCount<this._binCount&&console.warn(`Real bin count ${this._analyser.frequencyBinCount} was less than expected bin count ${this._binCount}`)}_start(){this.initialized||(this.initialized=!0,this._initialize()),this._overrunFrameCount=0,requestAnimationFrame(this._animate.bind(this))}_animate(){this._render(),this._ambienceManager.isPlaying()?requestAnimationFrame(this._animate.bind(this)):this._overrunFrameCount>this._analyser.fftSize?(this._clearCanvas(),this.running=!1):(requestAnimationFrame(this._animate.bind(this)),this._overrunFrameCount+=1)}_clearCanvas(){this._canvasCtx2D.clearRect(0,0,this._targetCanvas.width,this._targetCanvas.height)}_render(){this._analyser.getByteFrequencyData(this._out_arr),this._clearCanvas();for(let i=0;i<this._binCount;i++)this._binSums[i]=0,this._binCounts[i]=0;let e=1;for(let i=0;i<this._out_arr.length;i++)this._out_arr[i]>0&&(e=i);for(let i=0;i<e;i++){const t=i/e,n=Math.floor(t*this._binCount);this._binSums[n]+=this._out_arr[i],this._binCounts[n]+=1}const t=this._binWidth+this._binGap;this._canvasCtx2D.fillStyle=this._fillStyle;let n=this._fftScaleRatio;for(let i=0;i<this._binCount;i++)n=Math.max(n,this._binSums[i]/this._binCounts[i]);for(let i=0;i<this._binCount;i++){const e=this._binSums[i]/this._binCounts[i]/n,a=this._targetCanvas.height*e;this._canvasCtx2D.fillRect(t*i,this._targetCanvas.height-a,this._binWidth,a)}}}(U,3,"#109a76",128,.1);document.addEventListener("DOMContentLoaded",(()=>{const e=S(HTMLButtonElement,"#ambience-toggle"),t=S(HTMLDivElement,"#ambience-outer-wrapper"),n=S(HTMLDivElement,"#ambience-ui-container");U.register(S(HTMLDivElement,"#ambience-audio-container")),P.register(n),D.register(S(HTMLCanvasElement,"#ambience-fft-canvas")),w.register(S(HTMLDivElement,"#music-host")),M.register(S(HTMLDivElement,"#backgrounds-host")),T.register(S(HTMLElement,"body"),S(HTMLElement,"#meta-music-title"),S(HTMLImageElement,"#meta-banner-img"),S(HTMLElement,"#meta-artist-container"));const i=S(HTMLButtonElement,"#previous-hour-button"),a=S(HTMLButtonElement,"#next-hour-button");A.register(i,a),E.register(S(HTMLInputElement,"#volume-slider"),S(HTMLElement,"#volume-slider-container"));const o=S(HTMLButtonElement,"#bell-button");C.register(o),y.start();const r=document.querySelector("#play-pause-button");function s(){w.isPlaying?w.pause():w.play()}function l(e,t,n){let i=null,a=Array.isArray(t)?t:[t];document.addEventListener("keyup",(t=>{a.some((e=>t.key===e))&&(null==e||e.classList.remove("pressed"),null!==i&&clearTimeout(i))})),document.addEventListener("keydown",(t=>{t.target instanceof HTMLInputElement||t.target instanceof HTMLButtonElement||!a.some((e=>t.key===e))||(n(),null==e||e.classList.add("pressed"),i=setTimeout((()=>{null==e||e.classList.remove("pressed")}),3e3))}))}w.registerPlayPauseCallback((e=>{r.classList.remove("play"),r.classList.remove("pause"),r.innerHTML=e?"Pause":"Play",r.classList.add(e?"pause":"play")})),r.addEventListener("click",(()=>{s()}));let u=!1;const d=()=>{t.classList.toggle("open"),u||(u=!0,U.tryRestoreConfig())};e.addEventListener("click",d),l(e,"n",d),l(r," ",(()=>{s()})),l(i,["ArrowLeft","a"],(()=>{y.setHourOffset(y.hourOffset-1)})),l(a,["ArrowRight","d"],(()=>{y.setHourOffset(y.hourOffset+1)})),l(null,["ArrowUp","w"],(()=>{E.addVolume(.1)})),l(null,["ArrowDown","s"],(()=>{E.addVolume(-.1)})),l(o,["b"],(()=>{C.toggleBell()}));const c=S(HTMLButtonElement,"#period-button"),m=[60,30,20,15,5];let h=0;const b=()=>{h=(h+1)%m.length;const e=m[h];y.setMinutePeriod(e),c.dataset.buttonLabel=e.toString()};y.setMinutePeriod(60),c.dataset.buttonLabel=60..toString(),c.addEventListener("click",b),l(c,["p","t"],b),document.addEventListener("keydown",(e=>{"Escape"===e.key&&document.activeElement instanceof HTMLElement&&document.activeElement.blur()}))}));
